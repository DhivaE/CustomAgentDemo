name: FunctionalDesignDocumentToTechnicalDesignDocument
description: Generate Technical Design Document (TDD) JSON from FDD using repository-grounded rules

capabilities:
  tools:
    - http

instructions:

  # 1. Extract Work Item ID from user prompt
  - step: extract_input
    description: Extract Work Item ID from the user prompt
    output: workItemId

  # 2. Fetch FDD JSON from MCP Azure Function
  - step: fetch_fdd
    description: Fetch FDD content from MCP service
    tool: http
    method: GET
    url: https://devcopilotmcp-esceawhsbvekgwgu.eastus2-01.azurewebsites.net/api/fdd/{workItemId}?code=aHEE39eovMNux1zFkGLO6OhPvxuJmi_KcH4XWzzbN3BgAzFu_X4uNg==
    responseVariable: FDDContent

  # 3. Generate TDD JSON using FDD + knowledge base + prompt rules
  - step: generate_tdd
    description: |
      You are generating a Technical Design Document (TDD).

      ## Authoritative Inputs
      - Use **FDDContent** as the primary source of truth.
      - Use repository knowledge files as authoritative:
        - .knowledge/technical-standards.md
      - Follow all rules defined in:
        - .prompts/FDD2TDDSystemMessage.md

      ## Generation Rules
      - Generate **JSON only**.
      - Do NOT invent values not present in FDDContent or repository knowledge.
      - If a section is not defined in FDDContent, output `null` or an empty array.
      - Use exact naming conventions from technical standards.
      - Ensure relationships, entities, validations, and security are explicitly mapped.

      ## Output Expectations
      - Output must strictly conform to the sample TDD schema.
      - No markdown.
      - No explanations.
      - No comments.

output:
  format: json
